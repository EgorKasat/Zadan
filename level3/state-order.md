```mermaid
stateDiagram-v2
    [*] --> Новый
    Новый --> Подтвержденный : подтвердить
    Новый --> Отмененный : отменить
    
    Подтвержденный --> Оплаченный : оплатить
    Подтвержденный --> Отмененный : отменить
    
    state Оплата {
        [*] --> Ожидание
        Ожидание --> Успешно : платеж прошел
        Ожидание --> Ошибка : платеж не прошел
        Ошибка --> Успешно : повторная оплата
    }
    
    Оплаченный --> Оплата
    Оплата --> Отправленный : упаковать
    Отправленный --> Доставленный : доставить
    Доставленный --> Возвращенный : вернуть
    Доставленный --> [*] : завершить
    Отмененный --> [*]
    Возвращенный --> [*]